{if $ajaxModal <> 1}<!doctype html>
<html lang="{$currentLanguage}">
    <head>
        <meta charset="UTF-8">
        <title>{$layout->appDisplayName} {if $layout->sectionDetailed}{$layout->sectionDetailed}{else}{$layout->section}{/if}</title>
        <meta name="description" content="Panel Kryptos">
        <link href="/assets/plugins/jqueryui/ui-lightness/jquery-ui-1.10.4.custom.min.css" rel="stylesheet" />
         <link href="/assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
        <link href="/assets/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
        <link href="/assets/plugins/fontello/css/fontello.css" rel="stylesheet" />
        <link href="/assets/plugins/animate-css/animate.min.css" rel="stylesheet" />
        <link href="/assets/plugins/nifty-modal/css/component.css" rel="stylesheet" />
        <link href="/assets/plugins/magnific-popup/magnific-popup.css" rel="stylesheet" />
        <link href="/assets/plugins/ios7-switch/ios7-switch.css" rel="stylesheet" />
        <link href="/assets/plugins/pace/pace.css" rel="stylesheet" />
        <link href="/assets/plugins/sortable/sortable-theme-bootstrap.css" rel="stylesheet" />
        <link href="/assets/plugins/bootstrap-datepicker/css/datepicker.css" rel="stylesheet" />
        <link href="/assets/plugins/bootstrap-datetimepicker/bootstrap-datetimepicker.css" rel="stylesheet" />
        <link href="/assets/plugins/jquery-icheck/skins/all.css" rel="stylesheet" />
        <link rel="shortcut icon" href="/images/favicon.ico">
        <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
        <link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png">
        <!--form builder-->

        <!-- Extra CSS Libraries Start -->
        <link href="/assets/plugins/datatables.2016-06-17/DataTables-1.10.12/css/dataTables.bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="/assets/plugins/dropzone/css/dropzone.css" rel="stylesheet" type="text/css" />
        <!-- Extra CSS Libraries End -->
        <link href="/_gfx/style-responsive.css" rel="stylesheet" />
        <link href="/assets/plugins/jQuery-Validation-Engine-master/css/validationEngine.jquery.css" rel="stylesheet" type="text/css" />
        <link href="/assets/plugins/bxslider/jquery.bxslider.css" rel="stylesheet" type="text/css" />
        <link href="/assets/plugins/jquery-nestable/jquery.nestable.css" rel="stylesheet" type="text/css" />
        <link href="/assets/plugins/jquery-notifyjs/styles/metro/notify-metro.css" rel="stylesheet" type="text/css" />
        <link href="/_gfx/style.css" rel="stylesheet" type="text/css" />
        <link href="/assets/plugins/bootstrap-select/css/bootstrap-select.min.css" rel="stylesheet"/>

        <script src="/assets/plugins/jquery/jquery-1.11.1.min.js"></script>
        <script>
            var resizefunc = [];
        </script>
        <script src="/assets/plugins/bootstrap/js/bootstrap.min.js"></script>
        <script src="/assets/plugins/jqueryui/jquery-ui-1.10.4.custom.min.js"></script>
        <script src="/assets/plugins/jquery-ui-touch/jquery.ui.touch-punch.min.js"></script>
        <script src="/assets/plugins/jquery-detectmobile/detect.js"></script>
        <script src="/assets/plugins/jquery-animate-numbers/jquery.animateNumbers.js"></script>
        <script src="/assets/plugins/ios7-switch/ios7.switch.js"></script>
        <script src="/assets/plugins/fastclick/fastclick.js"></script>
        <script src="/assets/plugins/jquery-blockui/jquery.blockUI.js"></script>
        <script src="/assets/plugins/bootstrap-bootbox/bootbox.min.js"></script>
        <script src="/assets/plugins/jquery-slimscroll/jquery.slimscroll.js"></script>
        <script src="/assets/plugins/jquery-sparkline/jquery-sparkline.js"></script>
        <script src="/assets/plugins/sprintf/dist/sprintf.min.js"></script>
        <script src="/assets/plugins/bxslider/jquery.bxslider.min.js"></script>
        <script src="/assets/plugins/sortable/sortable.min.js"></script>
        <script src="/assets/plugins/bootstrap-fileinput/bootstrap.file-input.js"></script>
        <script src="/assets/plugins/bootstrap-select2/select2.min.js"></script>
        <script src="/assets/plugins/bootstrap-select/js/bootstrap-select.min.js" type="text/javascript" ></script>
        <script src="/assets/plugins/magnific-popup/jquery.magnific-popup.min.js"></script>
        <script src="/assets/plugins/pace/pace.min.js"></script>
        <script src="/assets/plugins/bootstrap-datepicker/js/bootstrap-datepicker-new.js"></script>
        <script src="/assets/plugins/bootstrap-datetimepicker/moment-with-locales.js"></script>
        <script src="/assets/plugins/bootstrap-datetimepicker/bootstrap-datetimepicker.js"></script>
        <script src="/assets/plugins/jquery-icheck/icheck.min.js"></script>
        <script src="/assets/plugins/dropzone/dropzone.js"></script>
        <script src="/assets/plugins/bootstrap-typeahead/bootstrap3-typeahead.js"></script>
        <script src="/_gfx/js/jquery.serialize-object.js"></script>
        <script src="/assets/plugins/jquery-wizard/jquery.easyWizard.js"></script>
        <script src="/assets/plugins/jquery-nestable/jquery.nestable.js"></script>
        <script src="/assets/plugins/jquery-notifyjs/notify.min.js"></script>
        <script src="/assets/plugins/jquery-notifyjs/styles/metro/notify-metro.js"></script>
        <script src="/assets/plugins/bootstrap-confirmation/bootstrap-confirmation.js"></script>
        <script src="/assets/plugins/jquery.timeago.js"></script>
        <script src="/assets/plugins/bootstrap-inputmask/inputmask.js"></script>
        <script src="/assets/plugins/surveyjs/survey.jquery.min.js"></script>

        <!-- Demo Specific JS Libraries -->
        <script src="/assets/plugins/prettify/prettify.js"></script>

        <script src="/_gfx/js/configuration.js"></script>
        <script src="/_gfx/js/prepare.js?{$jsVersion}"></script>

        <!-- Page Specific JS Libraries -->
 <!--        <script src="/assets/plugins/jszip-3.1.3/jszip.min.js"></script>
        <script src="/assets/plugins/pdfmake-0.1.31/pdfmake.min.js"></script>
        <script src="/assets/plugins/pdfmake-0.1.31/vfs_fonts.js"></script> -->
        <script src="/assets/plugins/datatables.2016-06-17/DataTables-1.10.12/js/jquery.dataTables.js"></script>
        <script src="/assets/plugins/datatables.2016-06-17/DataTables-1.10.12/js/dataTables.bootstrap.min.js"></script>
        <script src="/assets/plugins/datatables.2016-06-17/Buttons-1.2.1/js/dataTables.buttons.js"></script>
        <script src="/assets/plugins/datatables.2016-06-17/Buttons-1.2.1/js/buttons.bootstrap.min.js"></script>
        <script src="/assets/plugins/datatables.2016-06-17/Buttons-1.2.1/js/buttons.flash.min.js"></script>
        <script src="/assets/plugins/datatables.2016-06-17/Buttons-1.2.1/js/buttons.html5.js"></script>
        <script src="/assets/plugins/datatables.2016-06-17/Buttons-1.2.1/js/buttons.colVis.js"></script>
        <script src="/assets/plugins/datatables.2016-06-17/Responsive-2.1.0/js/dataTables.responsive.min.js"></script>
        <script src="/assets/plugins/datatables.2016-06-17/Responsive-2.1.0/js/responsive.bootstrap.min.js"></script>
        <script src="/_gfx/js/DT_bootstrap.js" type="text/javascript" charset="utf-8" language="javascript"></script>
        <script src="/assets/plugins/jQuery-Validation-Engine-master/js/jquery.validationEngine.js" type="text/javascript" ></script>
        <script src="/assets/plugins/jQuery-Validation-Engine-master/js/languages/jquery.validationEngine-pl.js" type="text/javascript" ></script>
        <script src="/assets/plugins/jquery-form/jquery.form.js" type="text/javascript" ></script>
        <script src="/assets/plugins/tinymce/js/tinymce/tinymce.min.js"></script>
        <script src="/_gfx/js/init.js"></script>
        <script src="/_gfx/js/backend_utilities.js"></script>
        <script src="/_gfx/js/app.js" type="text/javascript" charset="utf-8" language="javascript"></script>


      <link rel="stylesheet" type="text/css" href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
      <script type="text/javascript" src="/_gfx/plugins/form-builder/controls/employees.js"></script>
      <script type="text/javascript" src="/_gfx/plugins/form-builder/controls/datagrid.js"></script>
      <script type="text/javascript" src="/_gfx/plugins/form-builder/controls/documents.js"></script>
      <script type="text/javascript" src="/_gfx/plugins/form-builder/controls/date.js"></script>
      <script type="text/javascript" src="/_gfx/plugins/form-builder/controls/datetime.js"></script>
      <script type="text/javascript" src="/_gfx/plugins/form-builder/controls/zbiory.js"></script>
      <script type="text/javascript" src="/_gfx/plugins/form-builder/controls/surveys.js"></script>
      <script type="text/javascript" src="/_gfx/plugins/form-builder/controls/consent.js"></script>

<!--
      <script src="/_gfx/plugins/form-builder/vendor.js"></script>
-->
      <script src="/_gfx/plugins/form-builder/form-builder.min.js"></script>
      <script type="text/javascript" src="/_gfx/plugins/form-builder/form-builder.min.js"></script>



        <script type="text/javascript" charset="utf-8" language="javascript">
            $(document).ready(function () {
                App.init();
            });
            var logoutTs = {$session_expired_at},
                logoutDate = new Date(logoutTs * 1000),
                userLogin = '{$user_session->user->login}',
                lastMessageDate = {$lastMessageDate};
        </script>



         <!--  SCRIPT FOR TAB -->
       <style type="text/css">
           [class*=" icon-"]:before, [class^=icon-]:before{
            font-family: "fontello"!important;
            font-style: normal;
            font-weight: 400;
            speak: none;
            display: inline-block;
            text-decoration: inherit;
            width: 1em;
            margin-right: .2em;
            text-align: center;
            font-variant: normal;
            text-transform: none;
            line-height: 1em;
            margin-left: .2em;
            -webkit-font-smoothing: antialiased;
           }
           .form-wrap.form-builder .frmb-control li:first-child,.form-wrap.form-builder .frmb-control li:nth-child(2),.form-wrap.form-builder .frmb-control li:nth-child(3),.form-wrap.form-builder .frmb-control li:nth-child(4),.form-wrap.form-builder .frmb-control li:nth-child(6),.form-wrap.form-builder .frmb-control li:nth-child(7),.form-wrap.form-builder .frmb-control li:nth-child(8),.form-wrap.form-builder .frmb-control li:nth-child(9),.form-wrap.form-builder .frmb-control li:nth-child(10){
            display: none;
           }
       </style>



    </head>
    <body class="fixed-left">
        <script>
           var reg_id = {$id};
        </script>>
        <!-- Modal Start -->
        <!-- Modal Task Progress -->
        <div class="md-modal md-3d-flip-vertical" id="task-progress">
            <div class="md-content">
                <h3><strong>Task Progress</strong> Information</h3>

                <div>
                    <p>Nothing here</p>
                    <div class="progress progress-xs for-modal">
                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%">
                            <span class="sr-only">80&#37; Complete</span>
                        </div>
                    </div>
                    <p class="text-center">
                        <button class="btn btn-danger btn-sm md-close">Close</button>
                    </p>
                </div>
            </div>
        </div>
        <!-- Modal Logout -->
        <div class="md-modal md-just-me" id="logout-modal">
            <div class="md-content">
                <h3><strong>Wylogowywanie</strong> Potwierdzenie</h3>
                <div>
                    <p class="text-center">Czy na pewno chcesz się wylogować z systemu?</p>
                    <p class="text-center">
                        <button class="btn btn-danger md-close">Nie!</button>
                        <a href="/user/logout" class="btn btn-success md-close">Tak, jestem pewny</a>
                    </p>
                </div>
            </div>
        </div>        <!-- Modal End -->
        <!-- Begin page -->
        <div id="wrapper">

            <!-- Top Bar Start -->
            <div class="topbar">
                <div class="topbar-left">
                    <div class="logo">
                        <h1><a href="/home"><img src="/assets/images/kryptos.jpg" alt="ABI"></a></h1>
                    </div>
                    <button class="button-menu-mobile open-left">
                        <i class="fa fa-bars"></i>
                    </button>
                </div>
                <!-- Button mobile view to collapse sidebar menu -->
                <div class="navbar navbar-default" role="navigation">
                    <div class="container">
                        <div class="navbar-collapse2">
                            <ul class="nav navbar-nav hidden-xs hidden">
                                <li class="dropdown">
                                    <a href="#"><i class="icon-th"></i></a>
                                </li>
                                <li class="language_bar dropdown hidden-xs">
                                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Polski (PL) <i class="fa fa-caret-down"></i></a>
                                    <ul class="dropdown-menu pull-right">

                                    </ul>
                                </li>
                            </ul>
                            <ul class="nav navbar-nav navbar-right top-navbar">
                                <li class="dropdown iconify hide-phone">
                                    <!-- BEGIN NOTIFICATION DROPDOWN -->

                                    <!-- END NOTIFICATION DROPDOWN -->
                                </li>
                                <li class="dropdown iconify hide-phone">
                                    <!-- BEGIN Messages DROPDOWN -->

                                    <!-- END messages DROPDOWN -->
                                </li>
                                <li class="dropdown iconify hide-phone"><a><i class="icon-calendar" id="icon-calendar"></i></a></li>
                                <li class="dropdown iconify hide-phone"><a href="#" onclick="javascript:toggle_fullscreen()"><i class="icon-resize-full-2"></i></a></li>
                                {if $packageName}
                                <li class="dropdown iconify hide-phone"><a href="">Pakiet: <u>{$packageName}</u>
                                    {if $daysLeft}
                                    <small>(Pozostało dni: {$daysLeft})</small>
                                    {/if}
                                    </a></li>
                                {/if}
                                <li class="dropdown topbar-profile">
                                    {include file='layouts/_section-topbar-profile.html'}
                                </li>

                                <li class="dropdown iconify hide-phone topbar-messages">
                                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-tasks"></i>{if $tasks|@count}<span class="label label-danger absolute">{$tasks|@count}</span>{/if}</a>
                                    <ul class="dropdown-menu dropdown-message">
                                        <li class="dropdown-header notif-header"><i class="fa fa-tasks"></i> Zadania</li>
                                        {foreach $tasks as $task}
                                            <li class="unread">
                                                <a href="/tasks-my/details/id/{$task.id}">
                                                    <p><strong>{smart_date value=$task.deadline_date}</strong> {$task.task_title}</p>
                                                </a>
                                            </li>
                                            {foreachelse}
                                            <li class="empty-list">Nie masz zadań</li>
                                        {/foreach}
                                        <li class="dropdown-footer">
                                            <div class=""><a href="/tasks-my" class="btn btn-sm btn-block btn-primary"><i class="fa fa-share"></i> Zobacz wszystkie zadania</a></div>
                                        </li>
                                    </ul>
                                </li>

                                <li class="dropdown iconify hide-phone topbar-messages">
                                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-envelope"></i>{if $nieprzeczytaneSum}<span class="label label-danger absolute">{$nieprzeczytaneSum}</span>{/if}</a>
                                    <ul class="dropdown-menu dropdown-message">
                                        <li class="dropdown-header notif-header"><i class="icon-mail-2"></i> Nowe wiadomości</li>
                                        {foreach $nieprzeczytane as $nie}
                                            <li class="unread">
                                                <a href="/messages/view/id/{$nie.id}" class="clearfix">
                                                    <img src="/assets/img/users/user-100.jpg" class="xs-avatar ava-dropdown" alt="Avatar">
                                                    <strong>{$nie.imie} {$nie.nazwisko}</strong><i class="pull-right msg-time timeago" title="{$nie.created_at}">{$nie.created_at|substr:0:10}</i><br>
                                                    <p>{$nie.topic}</p>
                                                </a>
                                            </li>
                                            {foreachelse}
                                            <li class="empty-list">Nie masz nowych wiadomości</li>
                                        {/foreach}
                                        <li class="dropdown-footer">
                                            <div class=""><a href="/messages" class="btn btn-sm btn-block btn-primary"><i class="fa fa-share"></i> Zobacz wszystkie wiadomości</a></div>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <!--/.nav-collapse -->
                </div>
            </div>
        <!-- Top Bar End -->
        <!-- Left Sidebar Start -->
        <div class="left side-menu">
            <div class="sidebar-inner slimscrollleft">
                <!-- Search form
                 <form class="navbar-form" id="form-quick-search">
                     <div class="form-group">
                         <input type="text" id="quick_search_text" placeholder="Szukaj" class="form-control" value="">
                         <a href="javascript:;" id="quick_search" class="btn search-button"><i class="fa fa-search"></i></a>
                     </div>
                 </form>-->
                <br/>
                <div class="clearfix"></div>
                {include file="layouts/_section-profile-info.html"}
                <!--- Divider -->
                <div class="clearfix"></div>
                <hr class="divider" />
                <div class="clearfix"></div>
                <!--- Divider -->
                <div id="sidebar-menu">
                    {include file="layouts/_section-sidebar-navigation.html"}
                    <div class="clearfix"></div>
                </div>
                <div class="clearfix"></div><br><br><br>
            </div>
            <div class="left-footer">
                <div class="progress progress-xs">
                    <div class="progress-bar bg-green-1" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%">
                        <span class="progress-precentage">80%</span>
                    </div>

                    <a data-toggle="tooltip" title="See task progress" class="btn btn-default md-trigger" data-modal="task-progress"><i class="fa fa-inbox"></i></a>
                </div>
            </div>
        </div>
        <!-- Left Sidebar End -->
        <!-- Start right content -->
        <div class="content-page">
            <div class="content">
                <!-- ============================================================== -->
                <!-- Start Content here -->
                <!-- ============================================================== -->
                {include file="layouts/_section-sub-navigation.html"}
                {include file="layouts/_section-title.html"}
                <div class="row-fluid">
                    <div class="span12" id="space-header">
                        <div class="widget" id="content-widget">
                            <div class="widget-content padding">
                                {if $flashMessages}
                                    <div class="flashMessages">
                                        {foreach $flashMessages as $fm}
                                            {$fm nofilter}
                                        {/foreach}
                                    </div>
                                {/if}
                                <h2>Registry Form for Registry id : {$id}</h2>
                                {/if}{$layout->content nofilter}{if $ajaxModal <> 1}
                            </div>
                        </div>
                    </div>
                </div>
                <footer>
                    <a target="_blank" href="https://kryptos72.com">Kryptos</a> &copy; | System v.1
                    <div class="footer-links pull-right">
                        <a href="https://kryptos72.com">O nas</a>
                        <a href="/static/contact">Kontakt</a>
                        <a href="/assets/InstrukcjaKRYPTOS2017.pdf">Instrukcja Kryptos</a>
                        <a href="/static/napisz">Pomoc</a>
                    </div>
                    <div class="feedrss">
                        <span class="alert alert-info"><a href="#">Najnowszy feed RSS znajduje się właśnie tutaj! | A tutaj jest kolejny wpis z RSS pobrany z pomocą XML</a></span>
                    </div>
                </footer>
                <!-- Footer End -->
            </div>

            <!-- ============================================================== -->
            <!-- End content here -->
            <!-- ============================================================== -->

        </div>
        <!-- End right content -->

    </div>
                       <div class="modal fade" id="ajaxDial" tabindex="-1" role="dialog" aria-labelledby="ajaxDialLabel">
                           <div class="modal-dialog modal-lg ajaxDialSize" role="document">
                              <div class="modal-content onlyconent">
                                 <div class="modal-body">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"><i class="fa fa-close"></i></span></button>
                                     <div class="ajaxDialCont"></div>
                                 </div>
                              </div>
                           </div>
                        </div>

        <span class="md-trigger hidden" data-modal="relogin-modal" id="relogin-button"></span>
        <div class="md-modal md-just-me modal-relogin" id="relogin-modal">
            <div class="md-content">
            </div>
            <span class="md-close hidden"></span>
        </div>
    <!-- End of page -->
    <!-- the overlay modal element -->
    <div class="md-overlay"></div>
    <div class="alertsfixed"></div>

<!--fb-->



<!--fb-->
    <!-- End of eoverlay modal -->
    <script src="/assets/plugins/nifty-modal/js/classie.js"></script>
    <script src="/assets/plugins/nifty-modal/js/modalEffects.js"></script>
    <script src="/assets/plugins/nifty-modal/js/modernizr.custom.js"></script>
    <script src="/_gfx/js/controllers/layout/ui-message.js"></script>

    <script type="text/javascript">

            var fbInstances = [];
            var regChange = function(regSel){
                var entryRegistryIdElement = $(regSel),
                formElements = entryRegistryIdElement.closest('.form-elements');
                    var html = '<div class="alert alert-info entities-listing">'+
                        'Możesz korzystać z następujących tagów specjalnych:<br>' +
                        '<div class="list"></div>'+
                    '</div>';

                $.get('/registry/ajax-get-registry-entities/id/' + entryRegistryIdElement.val(), function(data) {
                    formElements.find('.entities-listing').remove();
                    formElements.find('.close-field').before(html);

                    var listWrapper = formElements.find('.entities-listing'),
                        list = listWrapper.find('.list');
                    if (!data.length || data == null) {
                        formElements.find('.entities-listing').remove();
                        formElements.find('.labelScheme-wrap').hide();
                        return;
                    }

                    listWrapper.show();
                    formElements.find('.labelScheme-wrap').show();
                    list.html('');

                    $.each(data, function() {
                        list.append('<div>{ldelim}'+this.system_name+'{rdelim} - '+this.title+'</div>');
                    });
                }).always(function(data) {
                    if (!data.length || data == null) {
                        formElements.find('.entities-listing').remove();
                        formElements.find('.labelScheme-wrap').hide();
                        return;
                    }
                });
            }
            $(function() {
              "use strict";
              var $fbPages = $(document.getElementById("form-builder-pages"));
              var addPageTab = document.getElementById("add-page-tab");

              var formBuilders = [];
              var currTabIndex = -1;

              $fbPages.tabs({
                beforeActivate: function(event, ui) {
                  if (ui.newPanel.selector === "#new-page") {

                    return false;
                  }
                },activate: function (event, ui) {
                    console.log("add tab = " + ui.newTab.index());
                    currTabIndex = ui.newTab.index();
                },remove: function( event, ui ) {
                  console.log("remove tab = " + ui.index);
                }
              });
              $('#form-builder-pages').find('#tabs input').on('keydown', function(event) {
                   event.stopPropagation();
               });

               var actionButtons = [{
                id: 'btn-column1',
                className: 'btn btn-success',
                label: 'One Col',
                type: 'button',
                events: {
                  click: function(e) {
                    // console.log($(e.target).closest('button').html());
                    // $(e.target).closest('button').html("abc");
                    // console.log(formBuilders[currTabIndex].actions.getColumnCount());

                    if (currTabIndex != -1) {
                      if (fbInstances[currTabIndex].actions.getColumnCount() == 1) {
                        fbInstances[currTabIndex].actions.switchColumn(2, true);
                        $(e.target).closest('button').html("One Col");
                      }
                      else /*if (formBuilders[currTabIndex].actions.getColumnCount() == 2)*/ {
                        fbInstances[currTabIndex].actions.switchColumn(1, true);
                        $(e.target).closest('button').html("Two Cols");
                      }
                    }
                  }
                }
              }];

             var formBuilderOptions = {literal}{disabledActionButtons:['data'], onSave: function(){saveAll();},actionButtons: actionButtons,
              registries: {/literal}{$registries_json nofilter}{literal}}{/literal};
              addPageTab.onclick = function() {

                if(($("#tabs li").length)<10){
                var tabCount = document.getElementById("tabs").children.length,
                  tabId = "page-" + tabCount.toString(),
                  $newPageTemplate = $(document.getElementById("new-page")),
                  $newPage = $newPageTemplate
                    .clone()
                    .attr("id", tabId)
                    .addClass("fb-editor"),
                  $newTab = $(this).clone().removeAttr("id");
                $($newTab).html("<input class='txt step-rename-textbox' type='text' onblur='onBlurInput(this)' contenteditable='true'/><a href='#page-"+tabCount+"' ondblclick='onDblClickTab(this)'>Step "+tabCount+ "</a>  <i class='fa fa-times' id='tab"+ tabCount+"' onclick='closeTab("+tabCount+")' style='cursor:pointer;'></i>");
                $($newTab).find('input').on('keydown', function(event) {
                  event.stopPropagation();
                });

                $($newPage).insertBefore($newPageTemplate);
                $newTab.insertBefore(this);
                $fbPages.tabs("refresh");
                $fbPages.tabs("option", "active", tabCount - 1);

                var formbuilder_new = $newPage.formBuilder(formBuilderOptions);
                // formBuilders.push(formbuilder_new);

                formbuilder_new.promise.then(function(fb){
                  // fb.actions.setData('[{$registries_json nofilter}]');
                  fb.actions.switchColumn(2);
                  fbInstances.push(formbuilder_new);
                });
                // fbInstances.push());
              }else{
                  alert("Allowed only less than 10 tabs");
              }

              };
                {if $entities}
                    {foreach $entities as $index => $tab}
                        {if $index > 0}
                            var tabCount = document.getElementById("tabs").children.length,
                            tabId = "page-" + tabCount.toString(),
                            $newPageTemplate = $(document.getElementById("new-page")),
                            $newPage = $newPageTemplate
                                .clone()
                                .attr("id", tabId)
                                .addClass("fb-editor"),
                            $newTab = $("#add-page-tab").clone().removeAttr("id");
                               $($newTab).html("<input class='txt step-rename-textbox' type='text' onblur='onBlurInput(this)' contenteditable='true'/><a href='#page-"+tabCount+"' ondblclick='onDblClickTab(this)'>Step "+tabCount+ "</a>  <i class='fa fa-times' id='tab"+ tabCount+"' onclick='closeTab("+tabCount+")' style='cursor:pointer;'></i>");

                            $($newTab).find('input').on('keydown', function(event) {
                               event.stopPropagation();
                           });
                            $newPage.insertBefore($newPageTemplate);
                            $newTab.insertBefore("#add-page-tab");
                            $fbPages.tabs("refresh");
                            $fbPages.tabs("option", "active", tabCount - 1);
                            var formBuilder_{$index} = $newPage.formBuilder(formBuilderOptions);
                            // formBuilders.push(formBuilder_{$index});

                            formBuilder_{$index}.promise.then(function(fb){
                              fb.actions.setData('{$tab nofilter}');
                              // fb.actions.switchColumn(2);
                              fbInstances.push(formBuilder_{$index});
                            });


                        {else}
                            var formBuilder_{$index} = $(".fb-editor").formBuilder(formBuilderOptions);
                            // formBuilders.push(formBuilder_{$index});

                            formBuilder_{$index}.promise.then(function(fb){
                              fb.actions.setData('{$tab nofilter}');
                              // fb.actions.switchColumn(2);
                              fbInstances.push(formBuilder_{$index});
                            });
                        {/if}

                        currTabIndex++;
                    {foreachelse}
                        fbInstances.push($(".fb-editor").formBuilder(formBuilderOptions));
                        currTabIndex++;
                    {/foreach}
                {else}
                    fbInstances.push($(".fb-editor").formBuilder(formBuilderOptions));
                    currTabIndex++;
                {/if}
                {if $tab_names}
                    {foreach $tab_names as $index => $tab_name}
                        var tabs_array = $("#tabs li:not(:last)");
                        $(tabs_array[{$index}]).find('input').val('{$tab_name}');
                        $(tabs_array[{$index}]).find('a').html('{$tab_name}');
                    {/foreach}
                {/if}
            });

            function closeTab(tabnum){
               $("#tab"+tabnum).parent().remove();
               $("#page-"+tabnum).remove();
               var tabCount = document.getElementById("tabs").children.length;


               var current = 1;
                $("#tabs li:not(:last)").each(function() {
                    $(this).attr('aria-controls','page-'+current);
                    current++;
                });
                var page = 1;
                $("#form-builder-pages .ui-tabs-panel:not(:last)").each(function() {
                  $(this).attr('id','page-'+page);
                   page++;
                });
            }
            function saveAll(){
                var allData = fbInstances.map(function(fb) {
                   if(fb.formData!='[]') {
                    return fb.formData;
                   }else{
                    return '';
                   }

                });
                var tab_names = [];
                $("#tabs li:not(:last)").each(function() {
                    tab_names.push($(this).find('a').html());
                });


                $.ajax({
                type: 'POST',
                url: '/registry-multi-form-builder/save/id/'+reg_id,
                data: { data: allData, names: tab_names},
                 success: function(response){ // What to do if we succeed
                            window.location = "/registry-multi-form-builder/index/id/"+reg_id

                          },
                });
            }
        </script>
</body>
<script type="text/javascript">
    jQuery(document).ready(function () {
        UIMessages.init();
    });
    function onDblClickTab(link)
    {
        var li = $(link).parent('li');
        $(li).find('input').toggle().val($(li).find('a').html()).focus();
        $(li).find('a').toggle();
    }
    function onBlurInput(input)
    {
        $(input).toggle();
        $(input).siblings('a').toggle().html($(input).val());
    }
</script>
<style type="text/css">
    .step-rename-textbox
    {
        display:none;
        width:120px;
        height: 24px;
    }
    #tabs li i {
        display: inline-block;
        margin-top: 10px;
        margin-right: 10px;
    }
    input.txt.step-rename-textbox {
        margin: 6px 1em 6px 1em;
        padding: 0 4px;
    }
    .save-template {
    color: #fff !important;
}
.form-wrap.form-builder .frmb .form-field .form-group label {
    padding-top: 0 !important;
}
[type="datagrid"] .alert.alert-info.entities-listing {
    display: none !important;
}
</style>


{if $jsEventAfterLogin}
<script>
    dtClearAllStateCache();
</script>
{/if}
</html>{/if}
